<!DOCTYPE html>
<html lang="pt-BR">
  
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PONTUAL v5.5 - Completo</title>
        <!-- Favicon padr√£o para navegadores modernos (PNG) -->
    <link rel="icon" type="image/png" href="favicon.png" sizes="32x32">

    <!-- Favicon para navegadores mais antigos e atalhos (ICO) -->
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

    <!-- √çcone para telas de toque (Apple Touch Icon) -->
    <link rel="apple-touch-icon" href="favicon.png">

    <style>
        /* ESTILOS B√ÅSICOS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: white; }
        
        .app { display: flex; min-height: 100vh; }
        .sidebar { background: #1e293b; padding: 20px 10px; display: flex; flex-direction: column; gap: 15px; }
        .sidebar button { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 10px; border-radius: 8px; }
        .sidebar button:hover { background: #334155; }
        
        main { flex: 1; padding: 20px; }
        .tab { display: block; }
        .hidden { display: none !important; }
        
        .big { font-size: 3rem; font-weight: bold; margin: 10px 0; }
        .date-display { font-size: 1.5rem; color: #94a3b8; }
        
        .clock-container, .alarms-container, .stopwatch-container, .pomodoro-container, .weather-container { 
            background: #1e293b; padding: 20px; border-radius: 10px; margin-top: 20px; 
        }
        
        .timezone-grid, .alarm-items, .laps-list { 
            display: grid; gap: 10px; margin: 15px 0; 
        }
        
        .timezone-item, .alarm-item, .lap-item { 
            background: #334155; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; 
        }
        
        .btn-format, .btn-add, .btn-save, .btn-control, .btn-preset, .btn-apply { 
            background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; 
        }
        
        .btn-control:hover, .btn-preset:hover { background: #2563eb; }
        
        h2 { color: #f8fafc; margin-bottom: 20px; }
        h3 { color: #cbd5e1; margin: 15px 0 10px 0; }
        
        .form-group { margin: 10px 0; }
        .input-time, .input-select, .input-text, .input-number { 
            padding: 8px; border-radius: 5px; border: 1px solid #475569; background: #334155; color: white; 
        }
        
        /* ESTILOS DO CLIMA */
        .weather-display { text-align: center; padding: 20px; }
        .weather-info-main { margin-bottom: 20px; }
        .weather-city-name { font-size: 1.8rem; font-weight: bold; }
        .weather-icon-large { font-size: 4rem; margin: 10px 0; }
        .weather-temp-big { font-size: 3.5rem; font-weight: bold; }
        .weather-description { font-size: 1.2rem; color: #94a3b8; text-transform: capitalize; }
        .weather-details-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 400px; margin: 0 auto; }
        .weather-detail-item { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; }
        .weather-detail-label { color: #cbd5e1; }
        .weather-detail-value { font-weight: bold; }
        
        /* CARD DO CLIMA */
        .weather-card { 
            background: linear-gradient(135deg, #1e293b, #334155); 
            border-radius: 15px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); 
        }
        
        /* ESTILOS PARA OUTRAS SE√á√ïES */
        .clock-controls, .alarms-form, .stopwatch-controls, .pomodoro-controls {
            margin: 20px 0;
        }
        
        .timezone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .tz-flag { font-size: 1.5rem; margin-right: 10px; }
        .tz-name { font-weight: bold; }
        .tz-time { margin-left: auto; color: #cbd5e1; }
        
        .alarm-items, .laps-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .alarm-time { font-size: 1.5rem; font-weight: bold; }
        .alarm-details { color: #94a3b8; }
        
        .stopwatch-display {
            text-align: center;
            margin: 20px 0;
        }
        
        .stopwatch-controls, .pomodoro-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .pomodoro-display {
            text-align: center;
            margin: 20px 0;
        }
        
        .pomo-status {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-top: 10px;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .settings-grid, .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .setting-item, .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 5px;
        }
        
        .stat-label { color: #cbd5e1; }
        .stat-value { font-weight: bold; float: right; }
        
        .pomodoro-notifications {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }
        
        /* RESPONSIVO */
        @media (max-width: 768px) {
            .app { flex-direction: column; }
            .sidebar { flex-direction: row; justify-content: center; padding: 10px; }
            .sidebar button { font-size: 20px; padding: 8px; }
            .big { font-size: 2rem; }
            .weather-details-grid { grid-template-columns: 1fr; }
            .settings-grid, .stats-grid { grid-template-columns: 1fr; }
            .timezone-grid { grid-template-columns: 1fr; }
            .stopwatch-controls, .pomodoro-controls { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <div class="app">
        <nav class="sidebar">
            <button onclick="showTab('clock')" title="Rel√≥gio">üïí</button>
            <button onclick="showTab('alarms')" title="Alarmes">üîî</button>
            <button onclick="showTab('stopwatch')" title="Cron√¥metro">‚è±Ô∏è</button>
            <button onclick="showTab('pomodoro')" title="Pomodoro">üçÖ</button>
            <button onclick="showTab('weather')" title="Clima">üå¶Ô∏è</button>
        </nav>
        
        <main>
            <!-- REL√ìGIO -->
            <section id="clock" class="tab">
                <h2>‚è∞ Rel√≥gio D2Z-TIME</h2>
                <div class="clock-container">
                    <div class="clock-display">
                        <div id="time" class="big">00:00:00</div>
                        <div id="date" class="date-display">--/--/----</div>
                    </div>
                    
                    <div class="clock-controls">
                        <label>Formato:</label>
                        <button onclick="toggleTimeFormat()" class="btn-format">12h/24h</button>
                    </div>

                    <div class="timezones-section">
                        <h3>Fusos Hor√°rios</h3>
                        <div class="timezone-grid">
                            <div class="timezone-item">
                                <span class="tz-flag">üáßüá∑</span>
                                <span class="tz-name">S√£o Paulo</span>
                                <span id="sp" class="tz-time">--:--:--</span>
                            </div>
                            <div class="timezone-item">
                                <span class="tz-flag">üá∫üá∏</span>
                                <span class="tz-name">Nova York</span>
                                <span id="ny" class="tz-time">--:--:--</span>
                            </div>
                            <div class="timezone-item">
                                <span class="tz-flag">üá¨üáß</span>
                                <span class="tz-name">Londres</span>
                                <span id="ld" class="tz-time">--:--:--</span>
                            </div>
                            <div class="timezone-item">
                                <span class="tz-flag">üá´üá∑</span>
                                <span class="tz-name">Paris</span>
                                <span id="pa" class="tz-time">--:--:--</span>
                            </div>
                            <div class="timezone-item">
                                <span class="tz-flag">üáØüáµ</span>
                                <span class="tz-name">T√≥quio</span>
                                <span id="tk" class="tz-time">--:--:--</span>
                            </div>
                            <div class="timezone-item">
                                <span class="tz-flag">üá¶üá∫</span>
                                <span class="tz-name">Sydney</span>
                                <span id="sy" class="tz-time">--:--:--</span>
                            </div>
                        </div>
                    </div>

                    <div class="custom-timezone">
                        <h3>Adicionar Fuso Hor√°rio</h3>
                        <div class="form-group">
                            <input type="text" id="tzName" placeholder="Ex: T√≥quio" class="input-text">
                            <input type="text" id="tzOffset" placeholder="Ex: Asia/Tokyo" class="input-text">
                            <button onclick="addCustomTimezone()" class="btn-add">+ Adicionar</button>
                        </div>
                        <div id="customTzList" class="custom-tz-list"></div>
                    </div>
                </div>
            </section>

            <!-- ALARMES -->
            <section id="alarms" class="tab hidden">
                <h2>üîî Alarmes D2Z-TIME</h2>
                <div class="alarms-container">
                    <div class="alarms-form">
                        <h3>Novo Alarme</h3>
                        <div class="form-group">
                            <label for="alarmTime">Hor√°rio:</label>
                            <input type="time" id="alarmTime" class="input-time">
                        </div>
                        <div class="form-group">
                            <label for="alarmDay">Dia da Semana:</label>
                            <select id="alarmDay" class="input-select">
                                <option value="0">Domingo</option>
                                <option value="1">Segunda-feira</option>
                                <option value="2">Ter√ßa-feira</option>
                                <option value="3">Quarta-feira</option>
                                <option value="4">Quinta-feira</option>
                                <option value="5">Sexta-feira</option>
                                <option value="6">S√°bado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alarmDesc">Descri√ß√£o (opcional):</label>
                            <input type="text" id="alarmDesc" class="input-text">
                        </div>
                        <button onclick="addAlarm()" class="btn-save">Salvar Alarme</button>
                    </div>
                    
                    <div class="alarms-list">
                        <h3>Alarmes Programados</h3>
                        <div id="alarmItems" class="alarm-items">
                            <!-- Alarmes ser√£o inseridos aqui -->
                            <p>Nenhum alarme configurado</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CRON√îMETRO -->
            <section id="stopwatch" class="tab hidden">
                <h2>‚è±Ô∏è Cron√¥metro D2Z-TIME</h2>
                <div class="stopwatch-container">
                    <div class="stopwatch-display">
                        <div id="stopwatchTime" class="big">00:00:00.00</div>
                    </div>
                    
                    <div class="stopwatch-controls">
                        <button onclick="startStopwatch()" id="startStopwatchBtn" class="btn-control">Iniciar</button>
                        <button onclick="lapStopwatch()" id="lapStopwatchBtn" class="btn-control hidden">Volta</button>
                        <button onclick="resetStopwatch()" id="resetStopwatchBtn" class="btn-control hidden">Zerar</button>
                    </div>

                    <div class="laps-section">
                        <h3>Voltas Registradas</h3>
                        <div id="lapsList" class="laps-list">
                            <!-- Voltas ser√£o inseridas aqui -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>Estat√≠sticas</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Melhor Volta:</span>
                                <span id="bestLap" class="stat-value">--:--:--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Pior Volta:</span>
                                <span id="worstLap" class="stat-value">--:--:--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total de Voltas:</span>
                                <span id="totalLaps" class="stat-value">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- POMODORO -->
            <section id="pomodoro" class="tab hidden">
                <h2>üçÖ Pomodoro D2Z-TIME</h2>
                <div class="pomodoro-container">
                    <div class="pomodoro-display">
                        <div id="pomodoroTime" class="big">25:00</div>
                        <div id="pomodoroStatus" class="pomo-status">Pronto</div>
                    </div>
                    
                    <div class="pomodoro-controls">
                        <button onclick="startPomodoro()" id="startPomodoroBtn" class="btn-control">Iniciar</button>
                        <button onclick="pausePomodoro()" id="pausePomodoroBtn" class="btn-control hidden">Pausar</button>
                        <button onclick="resetPomodoro()" id="resetPomodoroBtn" class="btn-control hidden">Zerar</button>
                    </div>
                    
                    <div class="pomodoro-presets">
                        <h3>Dura√ß√£o (minutos)</h3>
                        <div class="preset-buttons">
                            <button onclick="setPreset(25)" class="btn-preset">25 min</button>
                            <button onclick="setPreset(50)" class="btn-preset">50 min</button>
                            <button onclick="setPreset(90)" class="btn-preset">90 min</button>
                        </div>
                    </div>

                    <div class="pomodoro-settings">
                        <h3>Configura√ß√µes</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="workDuration">Trabalho (min):</label>
                                <input type="number" id="workDuration" class="input-number" value="25">
                            </div>
                            <div class="setting-item">
                                <label for="shortBreak">Pausa Curta (min):</label>
                                <input type="number" id="shortBreak" class="input-number" value="5">
                            </div>
                            <div class="setting-item">
                                <label for="longBreak">Pausa Longa (min):</label>
                                <input type="number" id="longBreak" class="input-number" value="15">
                            </div>
                            <div class="setting-item">
                                <label for="cycles">Ciclos at√© Pausa Longa:</label>
                                <input type="number" id="cycles" class="input-number" value="4">
                            </div>
                        </div>
                        <button onclick="applySettings()" class="btn-apply">Aplicar Configura√ß√µes</button>
                    </div>
                    
                    <div class="pomodoro-stats">
                        <h3>Estat√≠sticas</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Ciclos Completados:</span>
                                <span id="cyclesCompleted" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Tempo Trabalhado:</span>
                                <span id="timeWorked" class="stat-value">0h 0m</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Tempo em Pausa:</span>
                                <span id="timePaused" class="stat-value">0h 0m</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pomodoro-notifications">
                        <label><input type="checkbox" id="notifyCheckbox" checked> üîî Ativar Notifica√ß√µes</label>
                        <label><input type="checkbox" id="soundCheckbox" checked> üîä Ativar Som</label>
                    </div>
                </div>
            </section>

            <!-- CLIMA -->
            <section id="weather" class="tab hidden">
                <h2>üå¶Ô∏è Previs√£o do Tempo D2Z-TIME</h2>
                <div class="weather-container">
                    <div class="weather-card">
                        <h3>üìç Sua Localiza√ß√£o</h3>
                        <div id="currentWeather" class="weather-display">
                            <p>Carregando sua localiza√ß√£o...</p>
                            <div class="weather-info-main hidden">
                                <div id="weatherIcon" class="weather-icon-large">üå§Ô∏è</div>
                                <div id="weatherTemp" class="weather-temp-big">--¬∞C</div>
                                <div id="weatherDesc" class="weather-description">buscando dados...</div>
                            </div>
                            <div id="weatherDetails" class="weather-details-grid hidden">
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">Sensa√ß√£o</span>
                                    <span id="weatherFeelsLike" class="weather-detail-value">--¬∞C</span>
                                </div>
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">Umidade</span>
                                    <span id="weatherHumidity" class="weather-detail-value">--%</span>
                                </div>
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">Vento</span>
                                    <span id="weatherWind" class="weather-detail-value">-- km/h</span>
                                </div>
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">M√≠n / M√°x</span>
                                    <span id="weatherMinMax" class="weather-detail-value">-- / --</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weather-card">
                        <h3>üèôÔ∏è S√£o Paulo</h3>
                        <div id="spWeather" class="weather-display">
                            <div class="weather-info-main">
                                <div id="spWeatherIcon" class="weather-icon-large">‚òÄÔ∏è</div>
                                <div id="spWeatherTemp" class="weather-temp-big">23¬∞C</div>
                                <div id="spWeatherDesc" class="weather-description">Ensolarado</div>
                            </div>
                            <div class="weather-details-grid">
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">Sensa√ß√£o</span>
                                    <span id="spWeatherFeelsLike" class="weather-detail-value">23¬∞C</span>
                                </div>
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">Umidade</span>
                                    <span id="spWeatherHumidity" class="weather-detail-value">74%</span>
                                </div>
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">Vento</span>
                                    <span id="spWeatherWind" class="weather-detail-value">11 km/h</span>
                                </div>
                                <div class="weather-detail-item">
                                    <span class="weather-detail-label">M√≠n / M√°x</span>
                                    <span id="spWeatherMinMax" class="weather-detail-value">21¬∞ / 23¬∞</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weather-controls">
                        <h3>‚öôÔ∏è Controles do Clima</h3>
                        <p id="weatherStatus">‚úÖ Buscando dados do clima...</p>
                        <p id="lastUpdate">√öltima atualiza√ß√£o: --:--:--</p>
                        <p>Cache: Ativo (10min)</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Vari√°veis de estado
        let is24HourFormat = true;
        let timeInterval;
        let customTimezones = [];
        let alarms = [];
        let stopwatchInterval;
        let stopwatchTime = 0;
        let isStopwatchRunning = false;
        let laps = [];
        let pomodoroInterval;
        let pomodoroState = 'work'; // 'work', 'shortBreak', 'longBreak'
        let isPomodoroRunning = false;
        let cyclesCompleted = 0;
        let workDuration = 25 * 60;
        let shortBreak = 5 * 60;
        let longBreak = 15 * 60;
        let cyclesUntilLongBreak = 4;
        let pomodoroTimeLeft = workDuration;
        let timeWorked = 0;
        let timePaused = 0;
        let weatherCache = null;
        let lastWeatherUpdate = null;

        // Elementos DOM
        const timeDisplay = document.getElementById('time');
        const dateDisplay = document.getElementById('date');
        const spTime = document.getElementById('sp');
        const nyTime = document.getElementById('ny');
        const ldTime = document.getElementById('ld');
        const paTime = document.getElementById('pa');
        const tkTime = document.getElementById('tk');
        const syTime = document.getElementById('sy');
        const tzNameInput = document.getElementById('tzName');
        const tzOffsetInput = document.getElementById('tzOffset');
        const customTzList = document.getElementById('customTzList');
        const alarmTimeInput = document.getElementById('alarmTime');
        const alarmDayInput = document.getElementById('alarmDay');
        const alarmDescInput = document.getElementById('alarmDesc');
        const alarmItemsContainer = document.getElementById('alarmItems');
        const stopwatchTimeDisplay = document.getElementById('stopwatchTime');
        const startStopwatchBtn = document.getElementById('startStopwatchBtn');
        const lapStopwatchBtn = document.getElementById('lapStopwatchBtn');
        const resetStopwatchBtn = document.getElementById('resetStopwatchBtn');
        const lapsList = document.getElementById('lapsList');
        const bestLapDisplay = document.getElementById('bestLap');
        const worstLapDisplay = document.getElementById('worstLap');
        const totalLapsDisplay = document.getElementById('totalLaps');
        const pomodoroTimeDisplay = document.getElementById('pomodoroTime');
        const pomodoroStatusDisplay = document.getElementById('pomodoroStatus');
        const startPomodoroBtn = document.getElementById('startPomodoroBtn');
        const pausePomodoroBtn = document.getElementById('pausePomodoroBtn');
        const resetPomodoroBtn = document.getElementById('resetPomodoroBtn');
        const workDurationInput = document.getElementById('workDuration');
        const shortBreakInput = document.getElementById('shortBreak');
        const longBreakInput = document.getElementById('longBreak');
        const cyclesInput = document.getElementById('cycles');
        const cyclesCompletedDisplay = document.getElementById('cyclesCompleted');
        const timeWorkedDisplay = document.getElementById('timeWorked');
        const timePausedDisplay = document.getElementById('timePaused');
        const notifyCheckbox = document.getElementById('notifyCheckbox');
        const soundCheckbox = document.getElementById('soundCheckbox');
        const currentWeatherContainer = document.getElementById('currentWeather');
        const weatherIconDisplay = document.getElementById('weatherIcon');
        const weatherTempDisplay = document.getElementById('weatherTemp');
        const weatherDescDisplay = document.getElementById('weatherDesc');
        const weatherFeelsLikeDisplay = document.getElementById('weatherFeelsLike');
        const weatherHumidityDisplay = document.getElementById('weatherHumidity');
        const weatherWindDisplay = document.getElementById('weatherWind');
        const weatherMinMaxDisplay = document.getElementById('weatherMinMax');
        const weatherInfoMain = document.getElementById('currentWeather').querySelector('.weather-info-main');
        const weatherDetailsGrid = document.getElementById('weatherDetails');
        const weatherStatus = document.getElementById('weatherStatus');
        const lastUpdateDisplay = document.getElementById('lastUpdate');

        // Fun√ß√µes de Utilidade
        function formatTime(date, timezone) {
            const options = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: !is24HourFormat, 
                timeZone: timezone 
            };
            return date.toLocaleTimeString('pt-BR', options);
        }

        function formatDate(date) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return date.toLocaleDateString('pt-BR', options);
        }

        function formatDuration(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function formatStopwatchTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const cs = Math.floor((ms % 1000) / 10); // Cent√©simos de segundo
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}.${cs.toString().padStart(2, '0')}`;
        }

        function formatTimeInHours(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            return `${h}h ${m}m`;
        }

        // Fun√ß√µes do Rel√≥gio
        function updateClock() {
            const now = new Date();
            
            // Rel√≥gio Principal
            timeDisplay.textContent = formatTime(now, Intl.DateTimeFormat().resolvedOptions().timeZone);
            dateDisplay.textContent = formatDate(now);

            // Fusos Hor√°rios Padr√£o
            spTime.textContent = formatTime(now, 'America/Sao_Paulo');
            nyTime.textContent = formatTime(now, 'America/New_York');
            ldTime.textContent = formatTime(now, 'Europe/London');
            paTime.textContent = formatTime(now, 'Europe/Paris');
            tkTime.textContent = formatTime(now, 'Asia/Tokyo');
            syTime.textContent = formatTime(now, 'Australia/Sydney');

            // Fusos Hor√°rios Customizados
            customTimezones.forEach(tz => {
                const tzElement = document.getElementById(`custom-tz-${tz.id}`);
                if (tzElement) {
                    tzElement.textContent = formatTime(now, tz.offset);
                }
            });

            // Checar Alarmes
            checkAlarms(now);
        }

        function toggleTimeFormat() {
            is24HourFormat = !is24HourFormat;
            const btn = document.querySelector('.btn-format');
            btn.textContent = is24HourFormat ? '24h/12h' : '12h/24h';
            updateClock();
        }

        function addCustomTimezone() {
            const name = tzNameInput.value.trim();
            const offset = tzOffsetInput.value.trim();

            if (name && offset) {
                const newTz = {
                    id: Date.now(),
                    name: name,
                    offset: offset
                };
                customTimezones.push(newTz);
                renderCustomTimezones();
                tzNameInput.value = '';
                tzOffsetInput.value = '';
                saveState();
            } else {
                alert('Por favor, preencha o nome e o fuso hor√°rio.');
            }
        }

        function removeCustomTimezone(id) {
            customTimezones = customTimezones.filter(tz => tz.id !== id);
            renderCustomTimezones();
            saveState();
        }

        function renderCustomTimezones() {
            customTzList.innerHTML = '';
            customTimezones.forEach(tz => {
                const div = document.createElement('div');
                div.className = 'timezone-item';
                div.innerHTML = `
                    <span class="tz-flag">üåê</span>
                    <span class="tz-name">${tz.name}</span>
                    <span id="custom-tz-${tz.id}" class="tz-time">--:--:--</span>
                    <button onclick="removeCustomTimezone(${tz.id})" style="background: none; border: none; color: red; cursor: pointer; margin-left: 10px;">&times;</button>
                `;
                customTzList.appendChild(div);
            });
            updateClock(); // Atualiza os hor√°rios dos novos fusos
        }

        // Fun√ß√µes de Alarmes
        function addAlarm() {
            const time = alarmTimeInput.value;
            const day = parseInt(alarmDayInput.value);
            const desc = alarmDescInput.value.trim();

            if (time) {
                const newAlarm = {
                    id: Date.now(),
                    time: time,
                    day: day,
                    desc: desc,
                    active: true
                };
                alarms.push(newAlarm);
                renderAlarms();
                alarmTimeInput.value = '';
                alarmDescInput.value = '';
                saveState();
            } else {
                alert('Por favor, selecione um hor√°rio para o alarme.');
            }
        }

        function toggleAlarm(id) {
            const alarm = alarms.find(a => a.id === id);
            if (alarm) {
                alarm.active = !alarm.active;
                renderAlarms();
                saveState();
            }
        }

        function removeAlarm(id) {
            alarms = alarms.filter(a => a.id !== id);
            renderAlarms();
            saveState();
        }

        function renderAlarms() {
            alarmItemsContainer.innerHTML = '';
            if (alarms.length === 0) {
                alarmItemsContainer.innerHTML = '<p>Nenhum alarme configurado</p>';
                return;
            }

            const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];

            alarms.forEach(alarm => {
                const div = document.createElement('div');
                div.className = 'alarm-item';
                div.style.opacity = alarm.active ? '1' : '0.5';
                div.innerHTML = `
                    <div>
                        <div class="alarm-time">${alarm.time}</div>
                        <div class="alarm-details">${daysOfWeek[alarm.day]} - ${alarm.desc || 'Alarme'}</div>
                    </div>
                    <div>
                        <button onclick="toggleAlarm(${alarm.id})" class="btn-control" style="background: ${alarm.active ? '#10b981' : '#f59e0b'}; margin-right: 5px;">${alarm.active ? 'Ativo' : 'Inativo'}</button>
                        <button onclick="removeAlarm(${alarm.id})" class="btn-control" style="background: #ef4444;">Remover</button>
                    </div>
                `;
                alarmItemsContainer.appendChild(div);
            });
        }

        function checkAlarms(now) {
            const currentDay = now.getDay(); // 0 (Domingo) a 6 (S√°bado)
            const currentTime = now.toTimeString().substring(0, 5); // HH:MM

            alarms.forEach(alarm => {
                if (alarm.active && alarm.day === currentDay && alarm.time === currentTime) {
                    alert(`ALARME: ${alarm.desc || 'Alarme'} - ${alarm.time}`);
                    // Desativa o alarme ap√≥s tocar para evitar repeti√ß√£o imediata
                    alarm.active = false;
                    renderAlarms();
                    saveState();
                }
            });
        }

        // Fun√ß√µes do Cron√¥metro
        function startStopwatch() {
            if (!isStopwatchRunning) {
                isStopwatchRunning = true;
                startStopwatchBtn.textContent = 'Parar';
                startStopwatchBtn.onclick = pauseStopwatch;
                lapStopwatchBtn.classList.remove('hidden');
                resetStopwatchBtn.classList.add('hidden');

                const startTime = Date.now() - stopwatchTime;
                stopwatchInterval = setInterval(() => {
                    stopwatchTime = Date.now() - startTime;
                    stopwatchTimeDisplay.textContent = formatStopwatchTime(stopwatchTime);
                }, 10);
            }
        }

        function pauseStopwatch() {
            if (isStopwatchRunning) {
                isStopwatchRunning = false;
                clearInterval(stopwatchInterval);
                startStopwatchBtn.textContent = 'Continuar';
                startStopwatchBtn.onclick = startStopwatch;
                resetStopwatchBtn.classList.remove('hidden');
            }
        }

        function resetStopwatch() {
            if (!isStopwatchRunning) {
                stopwatchTime = 0;
                laps = [];
                stopwatchTimeDisplay.textContent = '00:00:00.00';
                startStopwatchBtn.textContent = 'Iniciar';
                startStopwatchBtn.onclick = startStopwatch;
                lapStopwatchBtn.classList.add('hidden');
                resetStopwatchBtn.classList.add('hidden');
                renderLaps();
                updateStopwatchStats();
                saveState();
            }
        }

        function lapStopwatch() {
            if (isStopwatchRunning) {
                const lapTime = stopwatchTime;
                const previousLapTime = laps.length > 0 ? laps[laps.length - 1].totalTime : 0;
                const splitTime = lapTime - previousLapTime;

                laps.push({
                    id: laps.length + 1,
                    totalTime: lapTime,
                    splitTime: splitTime
                });
                renderLaps();
                updateStopwatchStats();
                saveState();
            }
        }

        function renderLaps() {
            lapsList.innerHTML = '';
            laps.slice().reverse().forEach(lap => {
                const div = document.createElement('div');
                div.className = 'lap-item';
                div.innerHTML = `
                    <span>Volta ${lap.id}:</span>
                    <span>Total: ${formatStopwatchTime(lap.totalTime)}</span>
                    <span>Split: ${formatStopwatchTime(lap.splitTime)}</span>
                `;
                lapsList.appendChild(div);
            });
        }

        function updateStopwatchStats() {
            totalLapsDisplay.textContent = laps.length;

            if (laps.length > 0) {
                const splitTimes = laps.map(l => l.splitTime).slice(1); // Ignora o primeiro split (que √© o tempo total)
                
                if (splitTimes.length > 0) {
                    const bestSplit = Math.min(...splitTimes);
                    const worstSplit = Math.max(...splitTimes);
                    
                    bestLapDisplay.textContent = formatStopwatchTime(bestSplit);
                    worstLapDisplay.textContent = formatStopwatchTime(worstSplit);
                } else {
                    bestLapDisplay.textContent = '--:--:--';
                    worstLapDisplay.textContent = '--:--:--';
                }
            } else {
                bestLapDisplay.textContent = '--:--:--';
                worstLapDisplay.textContent = '--:--:--';
            }
        }

        // Fun√ß√µes do Pomodoro
        function startPomodoro() {
            if (!isPomodoroRunning) {
                isPomodoroRunning = true;
                startPomodoroBtn.classList.add('hidden');
                pausePomodoroBtn.classList.remove('hidden');
                resetPomodoroBtn.classList.remove('hidden');
                
                pomodoroInterval = setInterval(updatePomodoro, 1000);
                pomodoroStatusDisplay.textContent = pomodoroState === 'work' ? 'Trabalho' : (pomodoroState === 'shortBreak' ? 'Pausa Curta' : 'Pausa Longa');
            }
        }

        function pausePomodoro() {
            if (isPomodoroRunning) {
                isPomodoroRunning = false;
                clearInterval(pomodoroInterval);
                startPomodoroBtn.classList.remove('hidden');
                pausePomodoroBtn.classList.add('hidden');
                pomodoroStatusDisplay.textContent = 'Pausado';
            }
        }

        function resetPomodoro() {
            pausePomodoro();
            pomodoroState = 'work';
            pomodoroTimeLeft = workDuration;
            pomodoroTimeDisplay.textContent = formatDuration(pomodoroTimeLeft).substring(3, 8); // MM:SS
            pomodoroStatusDisplay.textContent = 'Pronto';
            startPomodoroBtn.classList.remove('hidden');
            pausePomodoroBtn.classList.add('hidden');
            resetPomodoroBtn.classList.add('hidden');
        }

        function updatePomodoro() {
            if (pomodoroTimeLeft > 0) {
                pomodoroTimeLeft--;
                pomodoroTimeDisplay.textContent = formatDuration(pomodoroTimeLeft).substring(3, 8); // MM:SS

                if (pomodoroState === 'work') {
                    timeWorked++;
                } else {
                    timePaused++;
                }
                updatePomodoroStats();
            } else {
                clearInterval(pomodoroInterval);
                playAlarmSound();
                
                if (pomodoroState === 'work') {
                    cyclesCompleted++;
                    if (cyclesCompleted % cyclesUntilLongBreak === 0) {
                        pomodoroState = 'longBreak';
                        pomodoroTimeLeft = longBreak;
                        sendNotification('Pomodoro', 'Hora da Pausa Longa!');
                    } else {
                        pomodoroState = 'shortBreak';
                        pomodoroTimeLeft = shortBreak;
                        sendNotification('Pomodoro', 'Hora da Pausa Curta!');
                    }
                } else {
                    pomodoroState = 'work';
                    pomodoroTimeLeft = workDuration;
                    sendNotification('Pomodoro', 'Hora de Voltar ao Trabalho!');
                }
                
                startPomodoro(); // Inicia o pr√≥ximo ciclo automaticamente
            }
        }

        function setPreset(minutes) {
            workDurationInput.value = minutes;
            applySettings();
        }

        function applySettings() {
            workDuration = parseInt(workDurationInput.value) * 60;
            shortBreak = parseInt(shortBreakInput.value) * 60;
            longBreak = parseInt(longBreakInput.value) * 60;
            cyclesUntilLongBreak = parseInt(cyclesInput.value);
            
            // Reinicia o pomodoro com as novas configura√ß√µes se estiver em 'work'
            if (pomodoroState === 'work' && !isPomodoroRunning) {
                pomodoroTimeLeft = workDuration;
                pomodoroTimeDisplay.textContent = formatDuration(pomodoroTimeLeft).substring(3, 8);
            }
            saveState();
        }

        function updatePomodoroStats() {
            cyclesCompletedDisplay.textContent = cyclesCompleted;
            timeWorkedDisplay.textContent = formatTimeInHours(timeWorked);
            timePausedDisplay.textContent = formatTimeInHours(timePaused);
            saveState();
        }

        function playAlarmSound() {
            if (soundCheckbox.checked) {
                // Tocar um som simples (pode ser necess√°rio um arquivo de √°udio real)
                // Exemplo: new Audio('alarm.mp3').play();
                console.log('Alarme Pomodoro Tocou!');
            }
        }

        function sendNotification(title, body) {
            if (notifyCheckbox.checked && "Notification" in window && Notification.permission === "granted") {
                new Notification(title, { body: body });
            }
        }

        // Fun√ß√µes de Clima (Simula√ß√£o)
        function getWeatherIcon(description) {
            if (description.includes('chuva')) return 'üåßÔ∏è';
            if (description.includes('sol') || description.includes('ensolarado')) return '‚òÄÔ∏è';
            if (description.includes('nuvens') || description.includes('nublado')) return '‚òÅÔ∏è';
            if (description.includes('parcialmente')) return '‚õÖ';
            return 'üå§Ô∏è';
        }

        function updateWeatherDisplay(data, container, isCurrentLocation = false) {
            const icon = container.querySelector('.weather-icon-large');
            const temp = container.querySelector('.weather-temp-big');
            const desc = container.querySelector('.weather-description');
            const feelsLike = container.querySelector('#weatherFeelsLike') || container.querySelector('#spWeatherFeelsLike');
            const humidity = container.querySelector('#weatherHumidity') || container.querySelector('#spWeatherHumidity');
            const wind = container.querySelector('#weatherWind') || container.querySelector('#spWeatherWind');
            const minMax = container.querySelector('#weatherMinMax') || container.querySelector('#spWeatherMinMax');
            const infoMain = container.querySelector('.weather-info-main');
            const detailsGrid = container.querySelector('.weather-details-grid');

            if (data) {
                icon.textContent = getWeatherIcon(data.description.toLowerCase());
                temp.textContent = `${data.temp}¬∞C`;
                desc.textContent = data.description;
                feelsLike.textContent = `${data.feelsLike}¬∞C`;
                humidity.textContent = `${data.humidity}%`;
                wind.textContent = `${data.wind} km/h`;
                minMax.textContent = `${data.min}¬∞ / ${data.max}¬∞`;

                if (isCurrentLocation) {
                    infoMain.classList.remove('hidden');
                    detailsGrid.classList.remove('hidden');
                    container.querySelector('p').classList.add('hidden');
                }
            } else if (isCurrentLocation) {
                container.querySelector('p').textContent = 'N√£o foi poss√≠vel obter a previs√£o do tempo.';
                infoMain.classList.add('hidden');
                detailsGrid.classList.add('hidden');
            }
        }

        function fetchWeather() {
            weatherStatus.textContent = '‚è≥ Buscando dados do clima...';
            
            // Simula√ß√£o de dados de clima
            const simulatedData = {
                current: {
                    temp: 25,
                    description: 'Parcialmente Nublado',
                    feelsLike: 26,
                    humidity: 65,
                    wind: 15,
                    min: 22,
                    max: 28
                },
                sp: {
                    temp: 23,
                    description: 'Ensolarado',
                    feelsLike: 23,
                    humidity: 74,
                    wind: 11,
                    min: 21,
                    max: 23
                }
            };

            // Simula um atraso de rede
            setTimeout(() => {
                weatherCache = simulatedData;
                lastWeatherUpdate = new Date();
                
                // Atualiza o display de S√£o Paulo (j√° est√° no HTML, mas atualizamos com a fun√ß√£o)
                updateWeatherDisplay(simulatedData.sp, document.getElementById('spWeather'));

                // Atualiza o display de Localiza√ß√£o Atual
                updateWeatherDisplay(simulatedData.current, currentWeatherContainer, true);
                
                weatherStatus.textContent = '‚úÖ Dados do clima atualizados.';
                lastUpdateDisplay.textContent = `√öltima atualiza√ß√£o: ${formatTime(lastWeatherUpdate, Intl.DateTimeFormat().resolvedOptions().timeZone)}`;
                saveState();
            }, 1500);
        }

        function checkWeatherCache() {
            const now = new Date();
            // 10 minutos de cache
            if (!weatherCache || !lastWeatherUpdate || (now.getTime() - lastWeatherUpdate.getTime() > 10 * 60 * 1000)) {
                fetchWeather();
            } else {
                weatherStatus.textContent = '‚úÖ Usando dados do cache.';
                lastUpdateDisplay.textContent = `√öltima atualiza√ß√£o: ${formatTime(lastWeatherUpdate, Intl.DateTimeFormat().resolvedOptions().timeZone)}`;
            }
        }

        // Fun√ß√µes de Estado (LocalStorage)
        function saveState() {
            const state = {
                is24HourFormat,
                customTimezones,
                alarms,
                stopwatchTime,
                laps,
                cyclesCompleted,
                workDuration: workDurationInput.value,
                shortBreak: shortBreakInput.value,
                longBreak: longBreakInput.value,
                cyclesUntilLongBreak: cyclesInput.value,
                timeWorked,
                timePaused,
                weatherCache,
                lastWeatherUpdate: lastWeatherUpdate ? lastWeatherUpdate.toISOString() : null
            };
            localStorage.setItem('pontualState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('pontualState');
            if (savedState) {
                const state = JSON.parse(savedState);
                
                is24HourFormat = state.is24HourFormat !== undefined ? state.is24HourFormat : true;
                customTimezones = state.customTimezones || [];
                alarms = state.alarms || [];
                stopwatchTime = state.stopwatchTime || 0;
                laps = state.laps || [];
                cyclesCompleted = state.cyclesCompleted || 0;
                timeWorked = state.timeWorked || 0;
                timePaused = state.timePaused || 0;
                weatherCache = state.weatherCache || null;
                lastWeatherUpdate = state.lastWeatherUpdate ? new Date(state.lastWeatherUpdate) : null;

                // Configura√ß√µes do Pomodoro
                workDurationInput.value = state.workDuration || 25;
                shortBreakInput.value = state.shortBreak || 5;
                longBreakInput.value = state.longBreak || 15;
                cyclesInput.value = state.cyclesUntilLongBreak || 4;
                applySettings(); // Aplica os valores carregados

                // Renderiza√ß√µes
                toggleTimeFormat(); // For√ßa a atualiza√ß√£o do bot√£o
                renderCustomTimezones();
                renderAlarms();
                renderLaps();
                updateStopwatchStats();
                updatePomodoroStats();
                
                // Clima
                if (weatherCache) {
                    updateWeatherDisplay(weatherCache.sp, document.getElementById('spWeather'));
                    updateWeatherDisplay(weatherCache.current, currentWeatherContainer, true);
                    lastUpdateDisplay.textContent = `√öltima atualiza√ß√£o: ${formatTime(lastWeatherUpdate, Intl.DateTimeFormat().resolvedOptions().timeZone)}`;
                }
            }
        }

        // Fun√ß√µes de Navega√ß√£o
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.add('hidden');
            });
            document.getElementById(tabId).classList.remove('hidden');
            
            // A√ß√µes espec√≠ficas ao mudar de aba
            if (tabId === 'weather') {
                checkWeatherCache();
            }
        }

        // Inicializa√ß√£o
        function init() {
            loadState();
            updateClock();
            setInterval(updateClock, 1000);
            
            // Permiss√£o de Notifica√ß√£o
            if ("Notification" in window) {
                Notification.requestPermission();
            }
            
            // Exibe a aba de rel√≥gio por padr√£o
            showTab('clock');
        }

        window.onload = init;
    </script>
</body>
</html>
